---
title: "How to generate missing values?"
author: "Teresa Alves de Sousa, Imke Mayer"
date: "19 March 2021"
output: 
  bookdown::html_document2:
    number_sections: yes
    toc: yes
    toc_depth: 3
    toc_float: yes 
  bookdown::pdf_document2:
    toc: yes
    toc_depth: '3'
linkcolor: blue
link-citations: yes
bibliography: ../bibliography.bib
---



<p>Missing values occur in many domains and most datasets contain missing values (due to non-responses, lost records, machine failures, dataset fusions, etc.). These missing values have to be considered before or during analyses of these datasets.</p>
<p>Now, if you have a method that deals with missing values, for instance imputation or estimation with missing values, how can you assess the performance of your method on a given dataset? If the data already contains missing values, than this does not help you since you generally do not have a ground truth for these missing values. So you will have to simulate missing values, i.e. you remove values – which you therefore know to be the ground truth – to generate missing values.</p>
<p>The mechanisms generating missing values can be various but usually they are classified into three main categories defined by <span class="citation">(Rubin <a href="#ref-inference_missData" role="doc-biblioref">1976</a>)</span>: <em>missing completely at random</em> (MCAR), <em>missing at random</em> (MAR) and <em>missing not at random</em> (MNAR). The first two are also qualified as <em>ignorable</em> missing values mechanisms, for instance in likelihood-based approaches to handle missing values, whereas the MNAR mechanism generates <em>nonignorable</em> missing values.
In the following we will briefly introduce each mechanism (with the definitions used widely in the literature) and propose ways of simulations missing values under these three mechanism assumptions. For more precise definitions we refer to references in the bibliography on the <a href="https://rmisstastic.netlify.com/" target="_blank">R-miss-tastic</a> website.</p>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<div id="notations" class="section level2">
<h2>Notations</h2>
<p>Let’s denote by <span class="math inline">\(\mathbf{X}\in\mathcal{X_1}\times\dots\times\mathcal{X_p}\)</span> the complete observations. We assume that <span class="math inline">\(\mathbf{X}\)</span> is a concatenation of <span class="math inline">\(p\)</span> columns <span class="math inline">\(X_j\in\mathcal{X_j}\)</span>, <span class="math inline">\(j\in\{1,\dots,p\}\)</span>, where <span class="math inline">\(dim(\mathcal{X_j})=n\)</span> for all <span class="math inline">\(j\)</span>.</p>
<p>The data can be composed of quantitative and/or qualitative values, hence <span class="math inline">\(\mathcal{X_j}\)</span> can be <span class="math inline">\(\mathbb{R}^n\)</span>, <span class="math inline">\(\mathbb{Z}^n\)</span> or more generally <span class="math inline">\(\mathcal{S}^n\)</span> for any discrete set <span class="math inline">\(S\)</span>.</p>
<p>Missing values are indicated as <code>NA</code> (not available) and we define an indicator matrix <span class="math inline">\(\mathbf{R}\in\{0,1\}^{n\times p}\)</span> such that <span class="math inline">\(R_{ij}=1\)</span> if <span class="math inline">\(X_{ij}\)</span> is observed and <span class="math inline">\(R_{ij}=0\)</span> otherwise. We call this matrix <span class="math inline">\(\mathbf{R}\)</span> the response (or missingness) pattern of the observations <span class="math inline">\(\mathbf{X}\)</span>. According to this pattern, we can partition the observations <span class="math inline">\(\mathbf{X}\)</span> into observed and missing: <span class="math inline">\(\mathbf{X} = (\mathbf{X}^{obs}, \mathbf{X}^{mis})\)</span>.</p>
</div>
<div id="definition-of-the-mechanisms" class="section level2">
<h2>Definition of the mechanisms</h2>
<p>In order to define the different missing values mechanisms, both <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{R}\)</span> are modeled as random variables with probability distributions <span class="math inline">\(\mathbb{P}_X\)</span> and <span class="math inline">\(\mathbb{P}_R\)</span> respectively. We parametrize the missingness distribution <span class="math inline">\(\mathbb{P}_R\)</span> by a parameter <span class="math inline">\(\phi\)</span>.</p>
<div id="mcar" class="section level3">
<h3>MCAR</h3>
<p>The observations are said to be Missing Completely At Random (MCAR) if the probability that an observation is missing is independent of the variables and observations: the probability that an observation is missing does not depend on <span class="math inline">\((\mathbf{X}^{obs},\mathbf{X}^{mis})\)</span>. Formally this is:
<span class="math display">\[\mathbb{P}_R(R\,|\, X^{obs}, X^{mis}; \phi) = \mathbb{P}_R(R) \qquad \forall \, \phi.\]</span></p>
</div>
<div id="mar" class="section level3">
<h3>MAR</h3>
<p>The observations are said to be Missing At Random (MAR) if the probability that an observation is missing only depends on the observed data <span class="math inline">\(\mathbf{X}^{obs}\)</span>. Formally,</p>
<p><span class="math display">\[\mathbb{P}_R(R\,|\,X^{obs},X^{mis};\phi)=\mathbb{P}_R(R\,|\,X^{obs};\phi) \qquad \forall \,\phi,\, \forall \, X^{mis}.\]</span></p>
</div>
<div id="mnar" class="section level3">
<h3>MNAR</h3>
<p>The observations are said to be Missing Not At Random (MNAR) in all other cases, i.e. the missingness depends on the missing values and potentially also on the observed values.</p>
</div>
</div>
</div>
<div id="use-of-produce_na-with-default-settings" class="section level1">
<h1>Use of <code>produce_NA</code> with default settings</h1>
<p>With the main function <code>produce_NA</code> it is possible to generate missing values for quantitative, categorical or mixed data, provided that it is available in form of a <code>data.frame</code> or <code>matrix</code>.</p>
<p>Missing values can be generated following one or more of the three main missing values mechanisms (see below for details).</p>
<p>If the data is already incomplete, it is possible to add a specific amount of additional missing values, in the already incomplete features or other complete features.</p>
<p>Important: Currently there is no option available for the mains function <code>produce_NA</code> to specify that every observation must contain at least one value after amputation. Hence, in the data.frame output by <code>produce_NA</code> there might be empty observations.</p>
<p>Except for the MCAR mechanism, our function <code>produce_NA</code> internally calls the <code>ampute</code> function of the <code>mice</code> R-package. See <span class="citation">(Schouten, Lugtig, and Vink <a href="#ref-mice-ampute" role="doc-biblioref">2018</a>)</span> for a detailed description of this latter function. A vignette for the function <code>ampute</code> is available <a href="https://rianneschouten.github.io/mice_ampute/vignette/ampute.html">here</a>.</p>
<p>We generate a small example of observations <span class="math inline">\(\mathbf{X}\)</span>:</p>
<pre class="r"><code>suppressPackageStartupMessages(require(MASS))
suppressPackageStartupMessages(require(norm))
suppressPackageStartupMessages(require(VIM))
suppressPackageStartupMessages(require(ggplot2))
suppressPackageStartupMessages(require(naniar))
library(&quot;devtools&quot;)</code></pre>
<pre><code>## Loading required package: usethis</code></pre>
<pre class="r"><code>source_url(&#39;https://raw.githubusercontent.com/R-miss-tastic/website/master/static/how-to/generate/amputation.R&#39;)</code></pre>
<pre><code>## SHA-1 hash of file is a392b353c3ba88ecd276c2d94bd36009d5d40616</code></pre>
<pre class="r"><code>set.seed(1)</code></pre>
<pre class="r"><code># Sample data generation ------------------------------------------------------
# Generate complete data
mu.X &lt;- c(1, 1)
Sigma.X &lt;- matrix(c(1, 1, 1, 4), nrow = 2)
n &lt;- 100
X.complete.cont &lt;- mvrnorm(n, mu.X, Sigma.X)

lambda &lt;- 0.5
X.complete.discr &lt;- rpois(n, lambda)

n.cat &lt;- 5
X.complete.cat &lt;- rbinom(n, size=5, prob = 0.5)

X.complete &lt;- data.frame(cbind(X.complete.cont, X.complete.discr, X.complete.cat))
X.complete[,4] &lt;- as.factor(X.complete[,4])
levels(X.complete[,4]) &lt;- c(&quot;F&quot;, &quot;E&quot;, &quot;D&quot;, &quot;C&quot;, &quot;B&quot;, &quot;A&quot;)</code></pre>
<div id="minimal-set-of-arguments" class="section level2">
<h2>Minimal set of arguments</h2>
<p>In order to generate missing values for given data, <code>produce_NA</code> requires the following arguments:</p>
<ul>
<li><code>data</code>: the initial data (can be complete or incomplete) as a matrix or data.frame</li>
<li><code>mechanism</code>: one of “MCAR”, “MAR”, “MNAR” (default: “MCAR”)</li>
<li><code>perc.missing</code>: the proportion of new missing values among the initially observed values (default: 0.5)</li>
</ul>
</div>
<div id="value" class="section level2">
<h2>Value</h2>
<p><code>produce_NA</code> returns a list containing three elements:</p>
<ul>
<li><code>data.init</code>: the initial data</li>
<li><code>data.incomp</code>: the data with the newly generated missing values (and the initial missing values if applicable)</li>
<li><code>idx_newNA</code>: a matrix indexing only the newly generated missing values</li>
</ul>
</div>
<div id="example" class="section level2">
<h2>Example</h2>
<p>On complete data</p>
<pre class="r"><code># Minimal example for generating missing data ------------------------
X.miss &lt;- produce_NA(X.complete, mechanism=&quot;MCAR&quot;, perc.missing = 0.2)

X.mcar &lt;- X.miss$data.incomp
R.mcar &lt;- X.miss$idx_newNA

writeLines(paste0(&quot;Percentage of newly generated missing values: &quot;, 100*sum(R.mcar)/prod(dim(R.mcar)), &quot; %&quot;))</code></pre>
<pre><code>## Percentage of newly generated missing values: 20.75 %</code></pre>
<pre class="r"><code>matrixplot(X.mcar, cex.axis = 0.5, interactive = F)</code></pre>
<p><img src="static/how-to/generate/missSimul_files/figure-html/minimal_example_1-1.png" width="672" /></p>
<p>On incomplete data:</p>
<pre class="r"><code># Minimal example for generating missing data on an incomplete data set ------------------------
X.miss &lt;- produce_NA(rbind(X.complete[1:50,], X.mcar[51:100,]), mechanism=&quot;MCAR&quot;, perc.missing = 0.2)

X.mcar &lt;- X.miss$data.incomp
R.mcar &lt;- X.miss$idx_newNA

writeLines(paste0(&quot;Percentage of newly generated missing values: &quot;, 100*sum(R.mcar)/prod(dim(R.mcar)), &quot; %&quot;))</code></pre>
<pre><code>## Percentage of newly generated missing values: 22.5 %</code></pre>
<pre class="r"><code>matrixplot(X.mcar, cex.axis = 0.5, interactive = F)</code></pre>
<p><img src="static/how-to/generate/missSimul_files/figure-html/minimal_example_2-1.png" width="672" /></p>
</div>
</div>
<div id="details-on-all-available-specifications" class="section level1">
<h1>Details on all available specifications</h1>
<p>The main function <code>produce_NA</code> allows generating missing values in various ways. These can be specified through different arguments:</p>
<p><code>produce_NA(data, mechanism = "MCAR", perc.missing = 0.5, self.mask=NULL, idx.incomplete = NULL, idx.covariates = NULL, weights.covariates = NULL, by.patterns = FALSE, patterns = NULL, freq.patterns = NULL, weights.patterns = NULL, use.all=FALSE, logit.model = "RIGHT", seed = NULL)</code></p>
<div id="mechanisms" class="section level2">
<h2>Mechanisms</h2>
<div id="mcar-1" class="section level3">
<h3>MCAR</h3>
<p>Missing Completely At Random values are generated using only the desired proportion of missing values <code>perc.missing</code>, i.e. each value have the same probability <code>perc.missings</code> of being missing. Therefore, we generate missing values using a Bernoulli distribution of parameter <code>perc.missing</code>.</p>
<pre class="r"><code># Sample mcar missing data -----------------------------------------
mcar &lt;- produce_NA(X.complete, mechanism=&quot;MCAR&quot;, perc.missing = 0.2)

X.mcar &lt;- mcar$data.incomp
R.mcar &lt;- mcar$idx_newNA

writeLines(paste0(&quot;Percentage of newly generated missing values: &quot;, 100*sum(R.mcar)/prod(dim(R.mcar)), &quot; %&quot;))</code></pre>
<pre><code>## Percentage of newly generated missing values: 22.25 %</code></pre>
<pre class="r"><code>matrixplot(X.mcar,  cex.axis = 0.5, interactive = F)</code></pre>
<p><img src="static/how-to/generate/missSimul_files/figure-html/mcar_data-1.png" width="672" /></p>
</div>
<div id="secmar" class="section level3">
<h3>MAR</h3>
<p>Missing At Random values are generated using a logistic model leading to <code>perc.missing</code> percent of missing values in each missing variable.</p>
<p>By default, all variables contain missing values (see Section <a href="#secincomp"><strong>??</strong></a> for changing it). More precisely, for <span class="math display">\[X=(X_1,X_2,X_3)=\begin{pmatrix}
1 &amp; 2 &amp; 3 \\
4 &amp; 5 &amp; 6 \\
7 &amp; 8 &amp; 9 \\
10 &amp; 11 &amp; 12
\end{pmatrix},\]</span> we generate missing values in <span class="math inline">\(X_1\)</span> using a logistic model depending on the variables <span class="math inline">\((X_2,X_3)\)</span> (thus the missingness depend on the observed values) where <span class="math inline">\(X_2\)</span> and <span class="math inline">\(X_3\)</span> have the same weights in the model (see Section <a href="#seccov"><strong>??</strong></a> for changing it).</p>
<p>Then, there are two strategies:</p>
<ul>
<li><p>By default, we first generate missing values in <span class="math inline">\(X_1\)</span> and obtain a matrix containing missing values in the first column, which can be for example
<span class="math display">\[X_1^\mathrm{NA}=\begin{pmatrix}
1  \\
\mathrm{NA} \\
7 \\
10
\end{pmatrix}.\]</span> We generate missing values in <span class="math inline">\(X_2\)</span> and <span class="math inline">\(X_3\)</span> in the same way to obtain <span class="math inline">\(X_2^\mathrm{NA}\)</span> and <span class="math inline">\(X_3^\mathrm{NA}\)</span>. The final matrix is formed by
<span class="math inline">\(X^\mathrm{NA}=(X_1^\mathrm{NA},X_2^\mathrm{NA},X_3^\mathrm{NA})\)</span>. The rows which only contain missing values are handled by replacing one of the missing values (chosen randomly) by its value given in <span class="math inline">\(X\)</span>.</p></li>
<li><p>We can also generate missing values by patterns setting <code>by.patterns=T</code>. For <span class="math inline">\(X\in \mathbb{R}^{n\times 2}\)</span>, by default the patterns matrix is
<span class="math display">\[\begin{pmatrix}
0 &amp; 1 &amp; 1 \\
1 &amp; 0 &amp; 1 \\
1 &amp; 1 &amp; 0
\end{pmatrix},\]</span>
where <code>0</code> indicates that the variable should have missing values whereas <code>1</code> means that it should be oserved. In this case, there is a maximum of one missing data per row, since we generate missing values directly for the full matrix <span class="math inline">\(X\)</span> using the patterns matrix repeatedly (the frequency of each pattern can be specified, see Section <a href="#secpattern"><strong>??</strong></a>, by default they have the same frequency).
We can also specify a patterns matrix (details are given in Section <a href="#secpattern"><strong>??</strong></a>).</p></li>
</ul>
<pre class="r"><code># Sample mar missing data ----------------------------------------
mar &lt;- produce_NA(X.complete, mechanism=&quot;MAR&quot;, perc.missing = 0.2, by.patterns= F)

X.mar &lt;- mar$data.incomp
R.mar &lt;- mar$idx_newNA

writeLines(paste0(&quot;Percentage of newly generated missing values: &quot;, 100*sum(R.mar)/prod(dim(R.mar)), &quot; %&quot;))</code></pre>
<pre><code>## Percentage of newly generated missing values: 20.25 %</code></pre>
<pre class="r"><code>matrixplot(X.mar,  cex.axis = 0.5, interactive = F)</code></pre>
<p><img src="static/how-to/generate/missSimul_files/figure-html/mar_data-1.png" width="672" /></p>
<p>Here, note that the generation of missing values relies on the first definition “by pattern” of MAR mechanism, which has been introduced in <span class="citation">(Rubin <a href="#ref-inference_missData" role="doc-biblioref">1976</a>)</span>. There exists other ways to generate missing values as described in the Python Notebook <a href="https://rmisstastic.netlify.app/how-to/python/generate_html/how%20to%20generate%20missing%20values">How generate missing values?</a>.</p>
</div>
<div id="mnar-1" class="section level3">
<h3>MNAR</h3>
<div id="logistic-model-with-missing-values-as-predictors" class="section level4">
<h4>Logistic model with missing values as predictors</h4>
<p>Missing Not At Random values are generated using a logistic model leading to <code>perc.missing</code> percent of missing values in each missing variable.</p>
<p>By default, all variables will contain missing values (see Section <a href="#secincomp"><strong>??</strong></a> for changing it). More precisely, for <span class="math inline">\(X=(X_1,X_2,X_3)\)</span> we will generate missing values in <span class="math inline">\(X_1\)</span> using a logistic model depending on the variables <span class="math inline">\((X_1,X_2,X_3)\)</span> (thus the missingness depends on the missing and observed values). Then, the same method as in Section <a href="#secmar"><strong>??</strong></a> is used.</p>
<pre class="r"><code># Sample mnar missing data -----------------------------------------
mnar &lt;- produce_NA(X.complete, mechanism=&quot;MNAR&quot;, perc.missing = 0.2, by.patterns= F)

X.mnar &lt;- mnar$data.incomp
R.mnar &lt;- mnar$idx_newNA

writeLines(paste0(&quot;Percentage of newly generated missing values: &quot;, 100*sum(R.mnar)/prod(dim(R.mnar)), &quot; %&quot;))</code></pre>
<pre><code>## Percentage of newly generated missing values: 18.25 %</code></pre>
<pre class="r"><code>matrixplot(X.mnar,  cex.axis = 0.5, interactive = F)</code></pre>
<p><img src="static/how-to/generate/missSimul_files/figure-html/mnar_data-1.png" width="672" /></p>
</div>
<div id="self-masked-mnar-for-quantitative-variables" class="section level4">
<h4>Self-masked MNAR (for quantitative variables)</h4>
<p>For self-masked MNAR values, the missingness of the variable <span class="math inline">\(X_j\)</span> only depends on the values of <span class="math inline">\(X_j\)</span>.</p>
<p>If the argument <code>self.mask</code> is filled in, self-masked missing Not At Random values are generated using a quantile censorship (three options: “sym”, “upper”, “lower”).</p>
<p>The variables for which missing values are generated can be given in the parameters <code>idx.incomplete</code>. Note that the proportion of missing values specified in the function call refers to the <strong>proportion w.r.t. the incomplete variables</strong>. Hence if you select half of your variables, to contain missing values and choose <code>perc.missing=0.2</code>, then the total proportion of missing values in the entire matrix/data.frame will be 0.2/2 = 0.1.</p>
<pre class="r"><code># Sample mnar missing data -----------------------------------------
mnar &lt;- produce_NA(X.complete, mechanism=&quot;MNAR&quot;, perc.missing = 0.2, self.mask=&quot;lower&quot;, idx.incomplete = c(1,1,0,0))

X.mnar &lt;- mnar$data.incomp
R.mnar &lt;- mnar$idx_newNA

writeLines(paste0(&quot;Percentage of newly generated missing values: &quot;, 100*sum(R.mnar)/prod(dim(R.mnar)), &quot; %&quot;))</code></pre>
<pre><code>## Percentage of newly generated missing values: 10 %</code></pre>
<pre class="r"><code>writeLines(paste0(&quot;Percentage of newly generated missing values (only w.r.t. to incomplete variables): &quot;, 100*sum(R.mnar)/prod(dim(R.mnar[,1:2])), &quot; %&quot;))</code></pre>
<pre><code>## Percentage of newly generated missing values (only w.r.t. to incomplete variables): 20 %</code></pre>
<pre class="r"><code>matrixplot(X.mnar,  cex.axis = 0.5, interactive = F)</code></pre>
<p><img src="static/how-to/generate/missSimul_files/figure-html/mnar_data_self-mask-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data=data.frame(X1=X.mnar[,1], X2=X.mnar[,2]),
       aes(x = X1,
           y = X2)) +
  geom_miss_point()</code></pre>
<p><img src="static/how-to/generate/missSimul_files/figure-html/mnar_data_self-mask-2.png" width="672" /></p>
<!-- ### Mixed mechanisms -->
</div>
</div>
</div>
<div id="secincomp" class="section level2">
<h2>Specify incomplete variables</h2>
<p>If you want to generate missing values only for a certain subset of variables, you can specify them by providing their position in the matrix/data.frame:</p>
<pre class="r"><code># Sample missing data for the first two variables in X ---------------------------------------
miss &lt;- produce_NA(X.complete, mechanism=&quot;MCAR&quot;, perc.missing = 0.2, idx.incomplete = c(1, 1, 1, 0))

X.miss &lt;- miss$data.incomp
R.miss &lt;- miss$idx_newNA

writeLines(paste0(&quot;Percentage of newly generated missing values (only w.r.t. to incomplete variables): &quot;, 100*sum(R.miss)/prod(dim(R.miss[,1:3])), &quot; %&quot;))</code></pre>
<pre><code>## Percentage of newly generated missing values (only w.r.t. to incomplete variables): 21.6666666666667 %</code></pre>
<pre class="r"><code>matrixplot(X.miss,  cex.axis = 0.5, interactive = F)</code></pre>
<p><img src="static/how-to/generate/missSimul_files/figure-html/idx.incomplete-1.png" width="672" /></p>
</div>
<div id="mice-specific-arguments" class="section level2">
<h2>Mice specific arguments</h2>
<p>In the <code>mice</code> package there exists a function that allows already to generate missing values, <code>mice::ampute</code>. Our <code>produce_NA</code> function calls this function at some point but we chose to extend certain options, for instance with <code>mice::ampute</code> it currently is not possible to add new missing values to an already incomplete data.frame/matrix.</p>
<p>In order to stay close to this <code>ampute</code> function from <code>mice</code> we adopted (and adapted) some of its arguments.</p>
<div id="seccov" class="section level3">
<h3>Covariates and covariates weights</h3>
<p>If you want to generate MAR or MNAR missing values, you can specify which variables will be used in the missingness model. You need to specify the variables that you want to use with a binary vector. For instance if you want to use variables 1 to 3 out of 7 variales, then you specify <code>idx.covariates = c(1,1,1,0,0,0,0)</code>.
And you need to specify their weights as well, i.e. their contribution in the model. For instance <code>weights.covariates = c(1/3, 1/3, 1/3, 0, 0, 0, 0)</code></p>
<p>Remark: if you choose <code>mechanism="MAR"</code> and <code>idx.incomplete = c(1,1,0,0,...,0)</code>, then <code>idx.covariates</code> must be of the form <code>c(0,0,*,*,...,*)</code> where <code>*</code> can be either 0 or a positive weight.</p>
<pre class="r"><code># Sample missing data for the first two variables in X ---------------------------------------
miss &lt;- produce_NA(X.complete, mechanism=&quot;MAR&quot;, perc.missing = 0.2, idx.incomplete = c(1, 0, 0, 0), idx.covariates = c(0,1,0,0), weights.covariates = c(0,1,0,0))

X.miss &lt;- miss$data.incomp
R.miss &lt;- miss$idx_newNA

writeLines(paste0(&quot;Percentage of newly generated missing values (only w.r.t. to incomplete variables): &quot;, 100*sum(R.miss)/length(R.miss[,1]), &quot; %&quot;))</code></pre>
<pre><code>## Percentage of newly generated missing values (only w.r.t. to incomplete variables): 26 %</code></pre>
<pre class="r"><code>matrixplot(X.miss,  cex.axis = 0.5, interactive = F)</code></pre>
<p><img src="static/how-to/generate/missSimul_files/figure-html/idx.covariates-1.png" width="672" /></p>
</div>
<div id="secpattern" class="section level3">
<h3>Patterns</h3>
<p>One might want to specify certain response/missingness patterns that are more relevant than others for a given application. This is possible by passing a matrix or data.frame whose rows contain the different patterns one wishes to generate.
Additionally it is possible to specify the frequency of each pattern. We refer to the <a href="https://www.gerkovink.com/Amputation_with_Ampute/Vignette/ampute.html" target="_blank">vignette of the mice::ampute function</a> for more details on this and other related options.</p>
<p>This option is only implemented for the MAR and MNAR mechanisms.</p>
<div id="default-patterns" class="section level4">
<h4>Default patterns</h4>
<p>If you want to use patterns but do not wish to specify them manually, you can set <code>by.patterns=T</code> and the patterns will automatically be of the form:</p>
<p><span class="math display">\[\begin{matrix}
0 &amp; 1 &amp; 1 &amp; 1 &amp; \dots &amp; 1 &amp; 1 \\
1 &amp; 0 &amp; 1 &amp; 1 &amp; \dots &amp; 1 &amp; 1\\
  &amp;   &amp;   &amp; \dots &amp;   &amp;   &amp;  \\
  &amp;   &amp;   &amp; \dots &amp;   &amp;   &amp;  \\
1 &amp; 1 &amp; 1 &amp; 1 &amp; \dots &amp; 1 &amp; 0
\end{matrix}\]</span></p>
<pre class="r"><code># Sample missing data by using the by.patterns option --------------------------------
miss &lt;- produce_NA(X.complete, mechanism=&quot;MAR&quot;, perc.missing = 0.2, by.patterns = T)

X.miss &lt;- miss$data.incomp
R.miss &lt;- miss$idx_newNA

writeLines(paste0(&quot;Percentage of newly generated missing values (only w.r.t. to incomplete variables): &quot;, 100*sum(R.miss)/prod(dim(R.miss)), &quot; %&quot;))</code></pre>
<pre><code>## Percentage of newly generated missing values (only w.r.t. to incomplete variables): 20.25 %</code></pre>
<pre class="r"><code>matrixplot(X.miss,  cex.axis = 0.5, interactive = F)</code></pre>
<p><img src="static/how-to/generate/missSimul_files/figure-html/patterns_1-1.png" width="672" /></p>
</div>
<div id="specific-patterns" class="section level4">
<h4>Specific patterns:</h4>
<p>We can also specify different patterns as follows.</p>
<pre class="r"><code># Sample missing data by using the by.patterns option and user-specified patterns ----
miss &lt;- produce_NA(X.complete, mechanism=&quot;MAR&quot;, perc.missing = 0.2, idx.incomplete = c(1,0,0,1), by.patterns = T, patterns = matrix(c(0,1,1,1,                                                                                                                  1,1,1,0), ncol = 4, byrow=T))

X.miss &lt;- miss$data.incomp
R.miss &lt;- miss$idx_newNA

writeLines(paste0(&quot;Percentage of newly generated missing values (only w.r.t. to incomplete variables): &quot;, 100*sum(R.miss)/(dim(R.miss)[1]*2), &quot; %&quot;))</code></pre>
<pre><code>## Percentage of newly generated missing values (only w.r.t. to incomplete variables): 21 %</code></pre>
<pre class="r"><code>matrixplot(X.miss,  cex.axis = 0.5, interactive = F)</code></pre>
<p><img src="static/how-to/generate/missSimul_files/figure-html/patterns_2-1.png" width="672" /></p>
<p>In addition, the frequency of each pattern can be chosen.</p>
<pre class="r"><code># Sample missing data by using the by.patterns option and user-specified patterns ----
miss &lt;- produce_NA(X.complete, mechanism=&quot;MAR&quot;, perc.missing = 0.2, idx.incomplete = c(1,0,1,1), by.patterns = T, patterns  = matrix(c(0,1,1,1,                                                                                                                  1,1,0,0), ncol = 4, byrow=T), freq.patterns = c(0.2, 0.8))

X.miss &lt;- miss$data.incomp
R.miss &lt;- miss$idx_newNA

writeLines(paste0(&quot;Percentage of newly generated missing values (only w.r.t. to incomplete variables): &quot;, 100*sum(R.miss)/(dim(R.miss)[1]*3), &quot; %&quot;))</code></pre>
<pre><code>## Percentage of newly generated missing values (only w.r.t. to incomplete variables): 15.3333333333333 %</code></pre>
<pre class="r"><code>matrixplot(X.miss,  cex.axis = 0.5, interactive = F)</code></pre>
<p><img src="static/how-to/generate/missSimul_files/figure-html/patterns_3-1.png" width="672" /></p>
</div>
</div>
<div id="logistic-model" class="section level3">
<h3>Logistic model</h3>
<p>There are four possible logistic distribution functions implemented in the <code>mice::ampute</code> function: left-tailed (<code>"LEFT"</code>), right-tailed (<code>"RIGHT"</code>), centered (<code>"MID"</code>), both-tailed (<code>"TAIL"</code>).</p>
<p>From the mice vignette: “[These] functions are applied to the weighted sum scores. For instance, in the situation of RIGHT missingness, cases with high weighted sum scores will have a higher probability to have missing values, compared to cases with low weighted sum scores.”</p>
<pre class="r"><code># Sample mar missing data with centered logistic distribution funciton ---------------
miss &lt;- produce_NA(X.complete, mechanism=&quot;MAR&quot;, perc.missing = 0.2, logit.model = &quot;MID&quot;)

X.miss &lt;- miss$data.incomp
R.miss &lt;- miss$idx_newNA

writeLines(paste0(&quot;Percentage of newly generated missing values: &quot;, 100*sum(R.miss)/prod(dim(R.miss)), &quot; %&quot;))</code></pre>
<pre><code>## Percentage of newly generated missing values: 22 %</code></pre>
<pre class="r"><code>matrixplot(X.mar,  cex.axis = 0.5, interactive = F)</code></pre>
<p><img src="static/how-to/generate/missSimul_files/figure-html/logit_model-1.png" width="672" /></p>
</div>
</div>
<div id="other-options" class="section level2">
<h2>Other options</h2>
<ul>
<li><code>seed</code>: specify a seed for the random values generator, useful to obtain reproducible examples.</li>
</ul>
</div>
<div id="full-list-of-arguments" class="section level2">
<h2>Full list of arguments</h2>
<pre class="r"><code>#&#39; @param data [data.frame, matrix] (mixed) data table (n x p)
#&#39; @param mechanism [string] either one of &quot;MCAR&quot;, &quot;MAR&quot;, &quot;MNAR&quot;; default is &quot;MCAR&quot;
#&#39; @param self.mask [string] either NULL or one of &quot;sym&quot;, &quot;upper&quot;, &quot;lower&quot;; default is NULL
#&#39; @param perc.missing [positive double] proportion of missing values, between 0 and 1; default is 0.5
#&#39; @param idx.incomplete [array] indices of variables to generate missing values for; if NULL then missing values in all variables are possible; default is NULL
#&#39; @param idx.covariates [matrix] binary matrix such that entries in row i that are equal to 1 indicate covariates that incluence missingness of variable i (sum(idx.incomplete) x p); if NULL then all covariates contribute; default is NULL
#&#39; @param weights.covariates [matrix] matrix of same size as idx.covariates with weights in row i for contribution of each covariate to missingness model of variable i; if NULL then a (regularized) logistic model is fitted; default is NULL
#&#39; @param by.patterns [boolean] generate missing values according to (pre-specified) patterns; default is FALSE
#&#39; @param patterns [matrix] binary matrix with 1=observed, 0=missing (n_pattern x p); default is NULL
#&#39; @param freq.patterns [array] array of size n_pattern containing desired proportion of each pattern; if NULL then mice::ampute.default.freq will be called ; default is NULL
#&#39; @param weights.patterns [matrix] weights used to calculate weighted sum scores (n_pattern x p); if NULL then mice::ampute.default.weights will be called; default is NULL
#&#39; @param use.all [boolean] use all observations, including incomplete observations, for amputation when amputing by patterns (only relevant if initial data is incomplete and by.pattern=T); default is FALSE
#&#39; @param logit.model [string] either one of &quot;RIGHT&quot;,&quot;LEFT&quot;,&quot;MID&quot;,&quot;TAIL&quot;; default is &quot;RIGHT&quot;
#&#39; @param seed [natural integer] seed for random numbers generator; default is NULL
#&#39; 
#&#39; @return A list with the following elements
#&#39; \item{data.init}{original data.frame}
#&#39; \item{data.incomp}{data.frame with the newly generated missing values, observed values correspond to the values from the initial data.frame}
#&#39; \item{idx_newNA}{a boolean data.frame indicating the indices of the newly generated missing values}</code></pre>
</div>
</div>
<div id="further-resources" class="section level1">
<h1>Further resources</h1>
<p>For more guidance on how to report results from simulations with and without missing values, we recomment the following resources:</p>
<ul>
<li><a href="https://onlinelibrary.wiley.com/doi/10.1002/sim.8086">Using simulation studies to evaluate statistical methods</a> (by Tim P. Morris, Ian R. White, and Michael J. Crowther)</li>
<li><a href="https://journals.sagepub.com/doi/full/10.1177/0049124118799376">The Dance of the Mechanisms: How Observed Information Influences the Validity of Missingness Assumptions</a> (by Rianne Margaretha Schouten and Gerko Vink)</li>
</ul>
</div>
<div id="session-info" class="section level1">
<h1>Session info</h1>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 4.0.2 (2020-06-22)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS  10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] mltools_0.3.5    mice_3.11.0      gdata_2.18.0     devtools_2.3.2  
##  [5] usethis_2.0.0    naniar_0.6.0     ggplot2_3.3.3    VIM_6.0.0       
##  [9] colorspace_2.0-0 norm_1.0-9.5     MASS_7.3-51.6   
## 
## loaded via a namespace (and not attached):
##  [1] fs_1.5.0          httr_1.4.2        rprojroot_2.0.2   tools_4.0.2      
##  [5] backports_1.1.9   R6_2.5.0          nnet_7.3-14       withr_2.3.0      
##  [9] sp_1.4-2          tidyselect_1.1.0  prettyunits_1.1.1 processx_3.4.5   
## [13] curl_4.3          compiler_4.0.2    cli_2.2.0         desc_1.2.0       
## [17] labeling_0.4.2    bookdown_0.20     scales_1.1.1      lmtest_0.9-37    
## [21] DEoptimR_1.0-8    robustbase_0.93-6 callr_3.5.1       stringr_1.4.0    
## [25] digest_0.6.27     foreign_0.8-80    rmarkdown_2.6     rio_0.5.16       
## [29] pkgconfig_2.0.3   htmltools_0.5.0   sessioninfo_1.1.1 highr_0.8        
## [33] rlang_0.4.10      readxl_1.3.1      farver_2.0.3      generics_0.1.0   
## [37] zoo_1.8-8         gtools_3.8.2      dplyr_1.0.2       zip_2.1.1        
## [41] car_3.0-9         magrittr_2.0.1    Matrix_1.2-18     Rcpp_1.0.5       
## [45] munsell_0.5.0     fansi_0.4.1       abind_1.4-5       lifecycle_0.2.0  
## [49] visdat_0.5.3      stringi_1.5.3     yaml_2.2.1        carData_3.0-4    
## [53] pkgbuild_1.2.0    forcats_0.5.0     crayon_1.3.4      lattice_0.20-41  
## [57] haven_2.3.1       hms_0.5.3         knitr_1.31.3      ps_1.5.0         
## [61] pillar_1.4.7      ranger_0.12.1     boot_1.3-25       pkgload_1.1.0    
## [65] glue_1.4.2        evaluate_0.14     blogdown_0.21     data.table_1.13.6
## [69] laeken_0.5.1      remotes_2.2.0     vcd_1.4-7         vctrs_0.3.6      
## [73] testthat_3.0.1    cellranger_1.1.0  gtable_0.3.0      purrr_0.3.4      
## [77] tidyr_1.1.2       assertthat_0.2.1  xfun_0.20         openxlsx_4.1.5   
## [81] broom_0.7.0       e1071_1.7-3       class_7.3-17      tibble_3.0.4     
## [85] memoise_1.1.0     ellipsis_0.3.1</code></pre>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-inference_missData">
<p>Rubin, Donald B. 1976. “Inference and Missing Data.” <em>Biometrika</em> 63 (3): 581–92. <a href="http://www.jstor.org/stable/2335739">http://www.jstor.org/stable/2335739</a>.</p>
</div>
<div id="ref-mice-ampute">
<p>Schouten, Rianne Margaretha, Peter Lugtig, and Gerko Vink. 2018. “Generating Missing Values for Simulation Purposes: A Multivariate Amputation Procedure.” <em>Journal of Statistical Computation and Simulation</em> 88 (15): 2909–30.</p>
</div>
</div>
</div>
